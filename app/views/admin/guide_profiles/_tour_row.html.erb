<%# locals: (tour:, booking: nil) %>
<div class="card">
  <div class="card-body">
    <div class="flex items-start justify-between mb-4">
      <div class="flex-1">
        <h3 class="text-xl font-semibold text-foreground">
          <%= link_to tour.title, admin_tour_path(tour), class: "hover:text-primary transition-colors" %>
        </h3>
        <p class="text-muted-foreground mt-2"><%= tour.description.truncate(200) %></p>
      </div>
      <span class="badge badge-<%= tour.status %> ml-4"><%= tour.status.titleize %></span>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
      <div>
        <p class="text-sm text-muted-foreground">Date & Time</p>
        <p class="font-medium text-foreground"><%= tour.starts_at.strftime("%b %d, %Y") %></p>
        <p class="text-sm text-muted-foreground"><%= tour.starts_at.strftime("%I:%M %p") %></p>
      </div>
      <div>
        <p class="text-sm text-muted-foreground">Duration</p>
        <p class="font-medium text-foreground"><%= tour.duration_minutes %> min</p>
      </div>
      <div>
        <p class="text-sm text-muted-foreground">Capacity</p>
        <p class="font-medium text-foreground">
          <%= tour.available_spots %>/<%= tour.max_spots %> spots
        </p>
        <div class="mt-1">
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-primary h-2 rounded-full" style="width: <%= [(tour.max_spots - tour.available_spots).to_f / tour.max_spots * 100, 100].min %>%"></div>
          </div>
        </div>
      </div>
      <div>
        <p class="text-sm text-muted-foreground">Bookings</p>
        <p class="font-medium text-foreground"><%= tour.bookings.count %></p>
      </div>
    </div>

    <% if tour.bookings.any? %>
      <div class="border-t border-border pt-4 mb-4">
        <h4 class="text-sm font-medium text-foreground mb-3">Recent Bookings</h4>
        <div class="space-y-2">
          <% tour.bookings.includes(:user).order(created_at: :desc).limit(3).each do |booking| %>
            <div class="flex items-center justify-between text-sm">
              <div class="flex items-center gap-2">
                <span class="text-foreground"><%= booking.user.name %></span>
                <span class="text-muted-foreground">•</span>
                <span class="text-muted-foreground"><%= booking.spots %> spot(s)</span>
              </div>
              <span class="badge badge-sm badge-<%= booking.status %>"><%= booking.status.titleize %></span>
            </div>
          <% end %>
          <% if tour.bookings.count > 3 %>
            <p class="text-sm text-muted-foreground">+ <%= tour.bookings.count - 3 %> more bookings</p>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if tour.weather_snapshots.any? %>
      <div class="border-t border-border pt-4 mb-4">
        <div class="flex items-center gap-2">
          <svg class="w-5 h-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"/>
          </svg>
          <span class="text-sm text-foreground">
            <%= tour.weather_snapshots.first.description %>
            (<%= tour.weather_snapshots.first.min_temp %>° - <%= tour.weather_snapshots.first.max_temp %>°C)
          </span>
        </div>
      </div>
    <% end %>

    <div class="flex gap-3 border-t border-border pt-4">
      <%= link_to "View", admin_tour_path(tour), class: "text-primary hover:text-primary/80 text-sm font-medium" %>
      <%= link_to "Edit Inline",
                  edit_admin_tour_path(tour),
                  class: "text-primary hover:text-primary/80 text-sm font-medium",
                  data: { turbo_frame: dom_id(tour) } %>
      <%= link_to "Edit Page", edit_admin_tour_path(tour), class: "text-primary hover:text-primary/80 text-sm font-medium" %>
      <% if tour.bookings.any? %>
        <%= link_to "Bookings (#{tour.bookings.count})", admin_bookings_path(tour_id: tour.id), class: "text-primary hover:text-primary/80 text-sm font-medium" %>
      <% end %>
    </div>
  </div>
</div>
