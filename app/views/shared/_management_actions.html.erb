<%#
  Shared management actions component
  Displays action buttons based on user permissions (Pundit policies)

  Params:
    resource: ActiveRecord::Base - The resource to perform actions on
    show_view: Boolean - Show "View" button (default: false)
    show_edit: Boolean - Show "Edit" button (default: true)
    show_delete: Boolean - Show "Delete" button (default: true)
    inline_edit: Boolean - Use inline editing for edit action (default: true)
    edit_label: String - Custom edit button label (default: "Edit")
    delete_label: String - Custom delete button label (default: "Delete")
    delete_confirmation: String - Custom delete confirmation message
    button_size: Symbol - :sm, :md, :lg (default: :sm)
    layout: Symbol - :horizontal or :vertical (default: :horizontal)
    additional_actions: Block - Additional custom actions to display
%>
<%
  show_view = local_assigns.fetch(:show_view, false)
  show_edit = local_assigns.fetch(:show_edit, true)
  show_delete = local_assigns.fetch(:show_delete, true)
  inline_edit = local_assigns.fetch(:inline_edit, true)
  edit_label = local_assigns.fetch(:edit_label, "Edit")
  delete_label = local_assigns.fetch(:delete_label, "Delete")
  delete_confirmation = local_assigns.fetch(:delete_confirmation, "Are you sure you want to delete this #{resource.model_name.human.downcase}?")
  button_size = local_assigns.fetch(:button_size, :sm)
  layout = local_assigns.fetch(:layout, :horizontal)

  # Button size classes
  size_classes = case button_size
                 when :sm
                   "px-2 py-1 text-xs"
                 when :lg
                   "px-6 py-3 text-base"
                 else
                   "px-3 py-1.5 text-sm"
                 end

  # Layout classes
  container_classes = layout == :vertical ? "flex flex-col gap-2" : "flex items-center gap-2"

  # Get permissions
  can_view = current_user_can_view?(resource)
  can_edit = current_user_can_edit?(resource)
  can_delete = current_user_can_delete?(resource)

  # Determine paths based on context
  resource_name = resource.model_name.param_key
  resource_path = management_context == :admin ? send("admin_#{resource_name}_path", resource) : send("#{resource_name}_path", resource)
  edit_path = management_context == :admin ? send("edit_admin_#{resource_name}_path", resource) : send("edit_#{resource_name}_path", resource)
%>

<div class="<%= container_classes %>">
  <%# View Button %>
  <% if show_view && can_view %>
    <%= link_to "View",
                resource_path,
                class: "inline-flex items-center justify-center #{size_classes} font-medium text-primary hover:text-primary/80 border border-primary hover:border-primary/80 rounded transition-colors",
                data: { turbo_frame: "_top" } %>
  <% end %>

  <%# Edit Button %>
  <% if show_edit && can_edit %>
    <% if inline_edit %>
      <%= link_to edit_label,
                  edit_path,
                  class: "inline-flex items-center justify-center #{size_classes} font-medium text-foreground hover:text-primary border border-border hover:border-primary rounded transition-colors",
                  data: {
                    turbo_frame: dom_id(resource),
                    action: "click->loading-state#showLoading"
                  } %>
    <% else %>
      <%= link_to edit_label,
                  edit_path,
                  class: "inline-flex items-center justify-center #{size_classes} font-medium text-foreground hover:text-primary border border-border hover:border-primary rounded transition-colors",
                  data: { turbo_frame: "_top" } %>
    <% end %>
  <% end %>

  <%# Delete Button %>
  <% if show_delete && can_delete %>
    <%= button_to delete_label,
                  resource_path,
                  method: :delete,
                  form: { data: { turbo_confirm: delete_confirmation } },
                  class: "inline-flex items-center justify-center #{size_classes} font-medium text-danger hover:text-danger/80 border border-danger hover:border-danger/80 rounded transition-colors" %>
  <% end %>

  <%# Additional Custom Actions %>
  <% if block_given? %>
    <%= yield %>
  <% end %>
</div>
