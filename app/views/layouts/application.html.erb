 <!DOCTYPE html>
 <html lang="en">
   <head>

    <title>
      <%= "#{strip_tags(yield(:title))} - " if content_for?(:title) %>
      Guide
    </title>

    <%= render "application/analytics/head" %>

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= tag.meta name: "sentry-dsn", content: ENV["SENTRY_DSN"] if ENV["SENTRY_DSN"].present? %>
    <%= tag.meta name: "sentry-environment", content: ENV["SENTRY_ENV"] || Rails.env %>

    <!-- Guide <%= Rails.application.config.version %> (<%= Rails.application.config.version_time&.iso8601 || "Unknown" %>) -->

    <%# Performance Optimizations %>
    <%= tag.meta name: "description", content: "Discover amazing tours with experienced guides. Book your next adventure today." %>
    <%= tag.link rel: "preconnect", href: "https://fonts.googleapis.com" %>
    <%= tag.link rel: "dns-prefetch", href: "https://cdn.example.com" %>
    <%= tag.link rel: "manifest", href: "/manifest.json" if Rails.env.production? %>

     <%# CSS should go closest to the top of the document as possible. %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload", media: "all" %>

    <%# JavaScript for Turbo and Stimulus - deferred for better performance %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>

    <%= yield(:head) %>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <%# Prevents the full URL, including potentially sensitive query strings being sent to external origins %>
    <meta name="referrer" content="origin-when-cross-origin"/>

    <%# Specifies the default name of home screen bookmark in iOS %>
    <meta name="apple-mobile-web-app-title" content="Guide"/>

    <%# Performance: Enable HTTP/2 Push, preload critical resources %>
    <link rel="preload" as="style" href="<%= stylesheet_path("application") %>"/>
    <link rel="preload" as="script" href="<%= javascript_path("application") %>"/>
  </head>

  <body>
    <div>
      <%= render "application/analytics/body" %>

      <%= render("application/header") %>
      <%= render("application/flash") %>

      <%# Notifications container for Turbo Stream updates %>
      <div id="notifications" class="fixed top-20 right-4 z-50 space-y-2"></div>

      <div role="main">
        <%= yield %>
      </div>
    </div>
  </body>
</html>
