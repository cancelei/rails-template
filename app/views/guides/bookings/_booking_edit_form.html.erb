<%# locals: (booking:) %>
<%= turbo_frame_tag dom_id(booking), target: "_top" do %>
<tr>
  <td colspan="5" class="px-6 py-4">
    <div class="card">
      <div class="card-body">
        <%= form_with model: [:guides, booking], method: :patch, data: { turbo_frame: dom_id(booking) } do |f| %>
          <h3 class="text-lg font-semibold text-foreground mb-2">Edit Booking</h3>
          <p class="text-sm text-muted-foreground mb-4">
            <%= booking.tour.title %> - <%= booking.user.name %>
          </p>

          <% if booking.errors.any? %>
            <div class="alert alert-danger mb-4">
              <h4 class="font-semibold mb-2"><%= pluralize(booking.errors.count, "error") %> prevented this booking from being saved:</h4>
              <ul class="text-sm list-disc list-inside">
                <% booking.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Customer Info (Read-only display) -->
            <div class="space-y-3">
              <div>
                <h4 class="text-sm font-medium text-muted-foreground mb-1">Customer</h4>
                <p class="text-foreground"><%= booking.user.name %></p>
                <p class="text-sm text-muted-foreground"><%= booking.user.email %></p>
              </div>
              <div>
                <h4 class="text-sm font-medium text-muted-foreground mb-1">Tour Details</h4>
                <p class="text-foreground"><%= booking.tour.title %></p>
                <p class="text-sm text-muted-foreground">
                  <%= booking.tour.starts_at.strftime("%B %d, %Y at %I:%M %p") %>
                </p>
              </div>
            </div>

            <!-- Editable Fields -->
            <div class="space-y-4">
              <div class="form-group">
                <%= f.label :status, "Booking Status", class: "form-label form-label-required" %>
                <%= f.select :status,
                             [
                               %w[Pending pending],
                               %w[Confirmed confirmed],
                               %w[Completed completed],
                               %w[Cancelled cancelled]
                             ],
                             {},
                             class: "form-input",
                             required: true %>
                <p class="text-xs text-muted-foreground mt-1">
                  Update the booking status based on customer confirmation
                </p>
              </div>

              <div class="form-group">
                <%= f.label :notes, "Internal Notes", class: "form-label" %>
                <%= f.text_area :notes,
                                rows: 3,
                                class: "form-input",
                                placeholder: "Add notes about special requirements, dietary restrictions, etc..." %>
              </div>
            </div>
          </div>

          <div class="flex gap-3 pt-4 mt-4 border-t border-border">
            <%= f.submit "Save Changes", class: "btn-booking", data: { controller: "loading-state", action: "loading-state#showLoading" } %>
            <%= link_to "Cancel",
                        guides_bookings_path,
                        class: "btn-booking-secondary",
                        data: { turbo_frame: dom_id(booking), turbo_action: "replace" } %>
          </div>
        <% end %>
      </div>
    </div>
  </td>
</tr>
<% end %>
